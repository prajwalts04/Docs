<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Document Submission Portal</title>
<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

<style>
/* --- CSS is retained from the previous design --- */
body {
  margin: 0;
  background: #f7f7f9;
  font-family: 'Open Sans', sans-serif;
  color: #333;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.container {
  max-width: 450px;
  width: 95%;
  background: white;
  padding: 30px;
  border-radius: 4px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  box-sizing: border-box;
}

h2 {
  text-align: center;
  color: #0056b3;
  margin-bottom: 25px;
  font-family: 'Merriweather', serif;
  font-weight: 700;
  font-size: 26px;
  border-bottom: 2px solid #e0e0e0;
  padding-bottom: 10px;
}

label {
  display: block;
  font-weight: 600;
  margin-bottom: 5px;
  color: #555;
  font-size: 14px;
}

input[type="text"], input[type="file"] {
  width: 100%;
  padding: 10px;
  border-radius: 2px;
  border: 1px solid #ccc;
  margin-bottom: 20px;
  font-size: 15px;
  transition: border-color 0.2s;
  box-sizing: border-box;
}

input[type="text"]:focus {
  border-color: #0056b3;
  box-shadow: 0 0 0 1px #0056b3;
  outline: none;
}

input[type="file"] {
  background-color: #f0f0f0;
  border-style: dashed;
  cursor: pointer;
  padding: 15px 10px;
  border-color: #aaa;
}

button {
  width: 100%;
  padding: 13px;
  background: #007bff;
  color: white;
  font-size: 16px;
  border-radius: 2px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  letter-spacing: 0.5px;
  transition: background 0.3s;
}

button:hover:not(:disabled) {
  background: #0056b3;
}

button:disabled {
  background: #c3d9f7;
  cursor: not-allowed;
}

.error {
  color: #cc0000;
  font-size: 13px;
  margin-top: -15px;
  margin-bottom: 20px;
  display: none;
}

#msg {
  text-align: center;
  margin-top: 25px;
  font-weight: 700;
  color: #1a6f00;
  padding: 12px;
  border: 1px solid #d4edda;
  background-color: #e9f5e9;
  border-radius: 4px;
}

#progressArea {
  display: none;
  margin-top: 25px;
}

.progressBg {
  width: 100%;
  background: #e0e0e0;
  height: 8px;
  border-radius: 4px;
}

#progressBar {
  width: 0%;
  height: 8px;
  background: #ffaa00;
  border-radius: 4px;
  transition: width 0.4s ease;
}

#statusText {
  text-align: center;
  margin-top: 10px;
  font-weight: 600;
  color: #0056b3;
  font-size: 13px;
}

@media (max-width: 480px) {
    .container {
        padding: 20px;
        width: 100%;
        margin: 0;
        box-shadow: none;
    }
}
</style>
</head>
<body>

<div class="container">

<h2>Document Submission Portal</h2>

<label for="name">Your Name *</label>
<input id="name" type="text" oninput="validateAndCheck('name', 'nameErr')">
<div id="nameErr" class="error">Name is required</div>

<label for="contact">Contact Number *</label>
<input id="contact" type="text" oninput="validateAndCheck('contact', 'contactErr')">
<div id="contactErr" class="error">Contact number must be at least 10 digits.</div>

<label for="file">Select PDF Document *</label>
<input id="file" type="file" accept="application/pdf" onchange="check()">

<button id="uploadBtn" disabled onclick="upload()">SUBMIT DOCUMENT</button>

<div id="progressArea">
  <div class="progressBg">
    <div id="progressBar"></div>
  </div>
  <div id="statusText">Preparing upload...</div>
</div>

<div id="msg"></div>

</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyn6zw19HiWmt58b4YTOhN28lNU9s13cel0BnAEHHztSBzjSuTfuN6R5p34BEtsyIOTqA/exec";

// Helper validation functions
const isNameValid = (value) => value.length > 0;
const isContactFormatValid = (value) => value.replace(/\D/g, '').length >= 10;

// --- CORE VALIDATION AND BUTTON CHECK ---
function check() {
  const name = document.getElementById("name").value.trim();
  const contact = document.getElementById("contact").value.trim();
  const fileSelected = document.getElementById("file").files.length > 0;
  
  const isNameOk = isNameValid(name);
  const isContactOk = isContactFormatValid(contact);
  
  // Enable button only if all validation passes
  document.getElementById("uploadBtn").disabled = !(isNameOk && isContactOk && fileSelected);
}

// --- SIMPLIFIED INLINE VALIDATION & ERROR DISPLAY ---
function validateAndCheck(inputId, errorId) {
    const input = document.getElementById(inputId);
    const errorElement = document.getElementById(errorId);
    let isValid = true;

    if (inputId === 'name') {
        isValid = isNameValid(input.value.trim());
    } else if (inputId === 'contact') {
        isValid = isContactFormatValid(input.value.trim());
    }
    
    // Show error only if field is empty/invalid AND it's been focused/typed in
    if (!isValid) {
        // Use a slight delay to allow the blur/focus change to happen smoothly
        setTimeout(() => {
            if (input.value.trim().length === 0) { // Check for empty only on blur
                 errorElement.style.display = 'block';
            } else if (inputId === 'contact' && !isContactFormatValid(input.value.trim())) {
                 errorElement.style.display = 'block';
            }
        }, 100);
    } else {
        errorElement.style.display = 'none';
    }

    check(); // Always check the button status
}

// --- ATTACH BLUR LISTENERS (For final error check when leaving a field) ---
document.addEventListener('DOMContentLoaded', () => {
    // Attach blur listeners to trigger the validation logic when the user leaves the field
    document.getElementById('name').addEventListener('blur', () => validateAndCheck('name', 'nameErr'));
    document.getElementById('contact').addEventListener('blur', () => validateAndCheck('contact', 'contactErr'));

    // Initial check to disable button on load
    check();
});


// --- UPLOAD FUNCTION (Progress Bar logic) ---
async function upload() {
  const name = document.getElementById("name").value.trim();
  const contact = document.getElementById("contact").value.trim();
  const file = document.getElementById("file").files[0];
  const progressBar = document.getElementById("progressBar");
  const statusText = document.getElementById("statusText");
  const msgDiv = document.getElementById("msg");

  // Re-run validation on button click as a final safety measure
  if (!isNameValid(name) || !isContactFormatValid(contact) || !file) {
      alert("Please ensure all fields are filled correctly.");
      // Force visual errors to show if validation fails on click
      validateAndCheck('name', 'nameErr');
      validateAndCheck('contact', 'contactErr');
      return;
  }

  // --- PROGRESS BAR INITIALIZATION (Ensures progress is visible) ---
  document.getElementById("progressArea").style.display = "block";
  msgDiv.innerHTML = "";
  
  progressBar.style.background = "#ffaa00"; 
  progressBar.style.width = "0%";
  statusText.innerText = "1. Starting Base64 conversion..."; 
  
  let progress = 0;
  let fake = setInterval(() => {
    progress = Math.min(progress + Math.random() * 5, 95); 
    progressBar.style.width = progress + "%";
    statusText.innerText = `2. Uploading Data... ${Math.round(progress)}%`; 
    if (progress >= 95) clearInterval(fake);
  }, 150);

  try {
    const base64 = await toBase64(file);
    
    statusText.innerText = "3. Awaiting Server Response..."; 

    const response = await fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({
        name: name,
        contact: contact,
        file: base64
      })
    });

    const msg = await response.text();
    
    // SUCCESS STATE 
    clearInterval(fake);
    progressBar.style.background = "#00cc00";
    progressBar.style.width = "100%";
    statusText.innerText = "Upload Complete ✔";
    msgDiv.innerHTML = msg;
    
  } catch(err) {
    // FAILURE STATE
    clearInterval(fake);
    progressBar.style.background = "#cc0000";
    progressBar.style.width = "100%";
    statusText.innerText = "Upload Failed ❌";
    msgDiv.innerHTML = "Upload Failed ❌<br>" + err;
  }
}

function toBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result.split(",")[1]);
    reader.onerror = error => reject(error);
    reader.readAsDataURL(file);
  });
}
</script>

</body>
</html>
